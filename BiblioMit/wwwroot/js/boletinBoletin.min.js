function exportReport(){}function exportExcel(){var n=params.urlgetxlsx;n=n.replace("YR",getVal("year")).replace("STR",getVal("start")).replace("END",getVal("end"));$.get(n,{},function(n){alasql.promise('SELECT INTO XLSX("MyAwesomeData.xlsx",?) FROM ?',[[{sheetid:"Name",header:!0},{sheetid:"Name",header:!0},{sheetid:"Name",header:!0},{sheetid:"Name",header:!0},{sheetid:"Name",header:!0},{sheetid:"Name",header:!0}],n]).then(function(){console.log("Data saved")}).catch(function(n){console.log("Error:",n)})})}function getVal(n){return $("#"+n).val()}function getText(n){return $("option:selected",$("#"+n)).text()}function getTab(){return $(".tab-pane.active").attr("id")}function setTxt(n,t){$("."+n).html(t)}function abbr(n){return n.substring(0,3)+"."}function tpChange(n){var c,l,p,e;loaderStart();var u=getVal("tp"),f=!1,t=!1,h="las";u===params.tp?f=!0:u>params.tp?t=!0:u<params.supply&&(h="los");setTxt("ga",h);t?$(".prod").addClass("d-none"):$(".prod").removeClass("d-none");$(".src").hide();t?$("#src-intemit").show():$("#src-sernapesca").show();c=t?disclaimer[1]:disclaimer[0];setTxt("tdisc",c);l=t?"Intemit":"Sernapesca";setTxt("tt-src",l);setTxt("tt-calc",t?params.average:params.total);var o=getVal("year"),w=getVal("start"),b=getVal("end"),k=abbr(getText("start"))+"-"+abbr(getText("end")),i,d=n.replace("Tabla","Comunas"),r=params.urlgetfn;r=r.replace("TP",u).replace("YR",o).replace("STR",w).replace("END",b).replace("FN",d);var s=!0,a="line",v=0,y="round";switch(n){case"Provincias":i=chart;break;case"Comunas":i=com;a="column";v=.8;y="";break;case"Meses":i=mes;break;case"Tabla":p=t?"NA":0;setTxt("dato",p);r=r+"&tb=true";console.log(r);$.get(r,{},function(n){var i=0,r=0,u=0,f=0,e,o;$.each(n,function(n,t){var e,o;t.year!=null&&(setTxt("yr."+t.comuna,Number(t.year).toLocaleString(params.lang)),i+=t.year,t.year!=="0"&&u++);t.lastyr!=null&&(setTxt("yr-1."+t.comuna,Number(t.lastyr).toLocaleString(params.lang)),r+=t.lastyr,t.lastyr!=="0"&&f++);t.aa_congelado!=null&&(e=t.aa_congelado+t.ab_conserva+t.ac_refrigerado,setTxt("yr."+t.comuna,Number(e).toLocaleString(params.lang)),i+=e,e!=="0"&&u++,o=t.ba_congelado+t.bb_conserva+t.bc_refrigerado,setTxt("yr-1."+t.comuna,Number(o).toLocaleString(params.lang)),r+=o,o!=="0"&&f++)});e=t?i/u:i;o=t?r/f:r;setTxt("yr.total",e.toLocaleString(params.lang));setTxt("yr-1.total",o.toLocaleString(params.lang))});s=!1;break;default:s=!1}e=params.urlgetattr;e=e.replace("TP",u);$.get(e,{},function(u){s&&(console.log(r),AmCharts.loadFile(r,{},function(r){var e=JSON.parse(r).reduce(function(n,t){for(var i in t)$.inArray(i,n)===-1&&i!=="date"&&i!=="comuna"&&n.push(i);return n},[]);i.graphs=[];n!=="Provincias"&&(n==="Comunas"&&(i.valueAxes[0].stackType=f?"regular":"none"),e.sort().forEach(function(r){var s=r==="lastyr"||r.startsWith("b")?parseInt(o)-1:o,h=r.replace(/[a-c]+_/,""),c=f?h:k,l=s+" "+c,p=f?"[[title]] ":"",w=r==="ac_refrigerado",e={title:l,valueField:r,balloonText:p+"[[category]]: <b>[[value]] "+abbr(u.units)+"<\/b>",lineAlphas:.2,fillAlphas:v,color:"#ff731c",bullet:y,bulletBorderAlpha:0,lineThickness:2,newStack:w};t?n==="Comunas"&&(e.bulletSize=10,e.fillAlphas=0,e.bullet="round",e.lineThickness=0,e.bulletBorderAlpha=2,e.useLineColorForBulletBorder=!0,e.bulletColor="#FFFFFF"):e.type=a;i.graphs.push(e)}));i.dataProvider=AmCharts.parseJSON(r);i.validateData()}));setTxt("tt-unit",u.units);setTxt("tt-unitabbr",abbr(u.units));setTxt("td",u.def);setTxt("tt",u.name);setTxt("gt",u.group)});loaderStop()}var loaderStart=()=>{document.getElementById("preloader-background").style.display="block"},loaderStop=()=>{document.getElementById("preloader-background").style.display="none"},params,lang,chart,com,mes,disclaimer;loaderStart();params=document.getElementById("js-parameters").dataset;document.getElementById("dtconf").onchange=function(){this.submit()};lang=document.getElementsByTagName("html")[0].getAttribute("lang");chart=AmCharts.makeChart("chart-provincias",{type:"pie",language:lang,labelText:"[[title]]\n[[percents]]%","export":{enabled:!0,menu:[]},listeners:[{event:"clickSlice",method:function(n){var u,i;if(getVal("tp")===params.tp){i=n.chart;u=n.dataItem.dataContext.id!==undefined?n.dataItem.dataContext.id:undefined;var r=[],f=getVal("year"),e=getVal("start"),o=getVal("end"),s={Palena:"#ff9e01",Llanquihue:"#ff6600","Chilo√©":"#ff0f00"},t=params.urlgetprovincias;t=t.replace("YR",f).replace("STR",e).replace("END",o);console.log(t);AmCharts.loadFile(t,{},function(n){var t=JSON.parse(n);$.each(t,function(n,t){if(t.id===u)for(var i=0;i<3;i++)r.push({provincia:t.subs[i].provincia,ton:t.subs[i].ton,color:s[t.provincia],pulled:!0});else r.push(t)});i.dataProvider=r;i.validateData()})}}}],outlineThickness:2,colorField:"color",outlineColor:"#FFFFFF",pulledField:"pulled",legend:{divId:"legend-provincias",position:"right",align:"center",valueText:"[[value]] Ton.",right:-4,valueWidth:80,marginRight:21},valueField:"ton",titleField:"provincia",balloon:{fixedPosition:!0},numberFormatter:{decimalSeparator:",",thousandsSeparator:"."}});chart.autoMargins=!1;chart.marginTop=40;chart.marginBottom=40;chart.marginLeft=0;chart.marginRight=0;chart.pullOutRadius=5;com=AmCharts.makeChart("chart-comunas",{type:"serial",language:lang,labelText:"[[title]]\n[[percents]]%",categoryField:"comuna",startDuration:1,categoryAxis:{minPeriod:"mm",autoGridCount:!1,equalSpacing:!0,gridCount:20,labelRotation:90,axisHeight:50},valueAxes:[{id:"ValueAxis-1",axisAlpha:0,minimum:0}],legend:{divId:"legend-comunas",position:"right"},"export":{enabled:!0,menu:[]},numberFormatter:{decimalSeparator:",",thousandsSeparator:"."}});mes=AmCharts.makeChart("chart-meses",{type:"serial",dataDateFormat:"YYYY-MM",valueAxes:[{position:"left",minimum:0,labelFrequency:1,strictMinMax:!0}],"export":{enabled:!0,menu:[]},categoryField:"date",categoryAxis:{autoGridCount:!1,gridCount:13,gridThickness:0,parseDates:!0,minPeriod:"MM",dateFormats:[{period:"MM",format:"MMM"},{period:"YYYY",format:"MMM"}]},legend:{divId:"legend-meses",align:"center",valueText:"[[value]]"},chartCursor:{categoryBalloonDateFormat:"MMM YYYY"},numberFormatter:{decimalSeparator:",",thousandsSeparator:"."}});AmCharts.shortMonthNames=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];disclaimer=[params.disclaimer0,params.disclaimer1];$('a[role="tab"]').on("click",function(){tpChange($(this).attr("name"))});$(".tipo").on("click",function(){var t=$(this).data("value"),n;$("select[name=tp]").val(t);n=getTab();t>params.tp&&n==="Provincias"&&$("#comunes").trigger("click");tpChange(n)});$(document).ready(function(){var n=getVal("year"),t=parseInt(n)-1,i=abbr(getText("start"))+"-"+abbr(getText("end"));setTxt("tt-year",n);setTxt("tt-year-1",t);setTxt("tt-range",i);tpChange(getTab())});